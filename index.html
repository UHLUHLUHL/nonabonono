<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nanobanana Pro</title>
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- CSS -->
    <link rel="stylesheet" href="css/style.css">
    <link rel="icon" type="image/png" href="assets/logo_icon.png">
    <!-- PWA -->
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="assets/logo_icon.png">
    <meta name="theme-color" content="#13161c">

    <!-- Icons -->
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0" />
</head>

<body>
    <div class="app-container">
        <!-- Sidebar (Optional for future use, keeps layout balanced) -->
        <aside class="sidebar">
            <div class="brand">
                <button id="logoHomeBtn" class="logo-btn" title="Reset to Home"
                    style="border:none; background:none; padding:0; cursor:pointer;">
                    <img src="assets/logo_icon.png" alt="Home" style="height: 32px; width:auto;">
                </button>
                <div style="flex:1;"></div>
                <button id="settingsBtn" class="icon-btn" title="Settings">
                    <span class="material-symbols-rounded">tune</span>
                </button>
            </div>

            <!-- Studio Mode Nav (Hidden by default) -->
            <div id="studioNav" style="display: none; margin-bottom: 20px;">
                <div class="nav-item active" id="navHome"
                    style="padding: 10px; cursor: pointer; border-radius: 6px; display: flex; align-items: center; gap: 8px; color: var(--text-primary);">
                    <span class="material-symbols-rounded">home</span> Home
                </div>
                <div class="nav-item" id="navPlayground"
                    style="padding: 10px; cursor: pointer; border-radius: 6px; display: flex; align-items: center; gap: 8px; color: var(--text-secondary);">
                    <span class="material-symbols-rounded">terminal</span> Playground
                </div>
                <div style="height: 1px; background: var(--border-color); margin: 10px 0;"></div>
            </div>

            <div class="history-label">Recent History</div>

            <!-- History Search -->
            <div class="history-search-wrapper">
                <span class="material-symbols-rounded search-icon">search</span>
                <input type="text" id="historySearchInput" placeholder="검색..." class="history-search-input">
            </div>

            <div class="history-list" id="historyList">
                <!-- History items will be injected here -->
            </div>

            <!-- Saved Prompts Section -->
            <div class="history-label" style="margin-top: 20px;">
                <span>Saved Prompts</span>
                <span id="savedPromptsCount" class="badge">0</span>
            </div>
            <div class="history-list" id="savedPromptsList">
                <!-- Saved prompts will be injected here -->
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header / Top Bar -->
            <header class="top-bar">
                <button id="sidebarToggleBtn" class="icon-btn" title="Toggle Sidebar">
                    <span class="material-symbols-rounded">menu_open</span>
                </button>
                <div class="top-bar-right">
                    <!-- Moved to Sidebar -->
                </div>
            </header>

            </header>

            <!-- Studio Home View (Hidden by default) -->
            <div id="studioHomeView" style="display: none; flex: 1; padding: 40px; overflow-y: auto;">
                <h1 style="font-size: 2rem; margin-bottom: 8px;">Hello, Creator</h1>
                <p style="color: var(--text-secondary); margin-bottom: 32px;">Start creating with Nanobanana Pro models.
                </p>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                    <!-- Card 1 -->
                    <div class="studio-card" onclick="document.getElementById('navPlayground').click()"
                        style="background: var(--bg-surface); border: 1px solid var(--border-color); border-radius: 12px; padding: 24px; cursor: pointer; transition: all 0.2s;">
                        <div
                            style="width: 40px; height: 40px; background: rgba(168, 199, 250, 0.1); border-radius: 8px; display: flex; align-items: center; justify-content: center; margin-bottom: 16px;">
                            <span class="material-symbols-rounded" style="color: var(--accent);">image</span>
                        </div>
                        <h3 style="margin-bottom: 8px;">New Image Project</h3>
                        <p style="color: var(--text-secondary); font-size: 0.9rem;">Clean canvas with Gemini 3 Pro.</p>
                    </div>
                    <!-- Card 2 -->
                    <div class="studio-card"
                        style="background: var(--bg-surface); border: 1px solid var(--border-color); border-radius: 12px; padding: 24px; cursor: pointer; transition: all 0.2s; opacity: 0.7;">
                        <div
                            style="width: 40px; height: 40px; background: rgba(255, 255, 255, 0.05); border-radius: 8px; display: flex; align-items: center; justify-content: center; margin-bottom: 16px;">
                            <span class="material-symbols-rounded">folder_open</span>
                        </div>
                        <h3 style="margin-bottom: 8px;">Load Project</h3>
                        <p style="color: var(--text-secondary); font-size: 0.9rem;">Open local history (Coming soon).
                        </p>
                    </div>
                </div>
            </div>

            <!-- Results Area -->
            <div class="results-container" id="resultsContainer">
                <div class="placeholder-state" id="placeholderState">
                    <span class="material-symbols-rounded icon-large">image</span>
                    <p>상상력을 발휘하여 이미지를 생성해보세요.</p>
                </div>
                <div class="image-grid" id="imageGrid">
                    <!-- Images will be injected here -->
                </div>
            </div>

            <!-- Input Area -->
            <div class="input-area-wrapper">
                <div class="input-container">
                    <div class="input-controls">
                        <!-- Image Count Selector -->
                        <div class="control-group">
                            <label>이미지 수</label>
                            <div class="count-group">
                                <button class="count-btn active" data-count="1">1</button>
                                <button class="count-btn" data-count="2">2</button>
                                <button class="count-btn" data-count="4">4</button>
                                <button class="count-btn" data-count="8">8</button>
                            </div>
                        </div>
                        <!-- Resolution Selector -->
                        <div class="control-group">
                            <label>해상도</label>
                            <select id="resolutionSelect" class="resolution-select">
                                <option value="1k">Standard (1K)</option>
                                <option value="2k">High (2K)</option>
                                <option value="4k">Ultra (4K)</option>
                            </select>
                        </div>
                        <!-- Translation Toggle -->
                        <div class="control-group">
                            <label>번역</label>
                            <button id="translateToggleBtn" class="toggle-btn active" title="한→영 자동 번역">
                                <span class="material-symbols-rounded" style="font-size:16px;">translate</span>
                                <span class="toggle-label">ON</span>
                            </button>
                        </div>
                        <!-- Spacer -->
                        <div style="flex:1;"></div>
                        <!-- Actions Trigger Group -->
                        <div class="control-group" id="downloadGroup" style="display:none;">
                            <button id="downloadAllBtn" class="count-btn" style="color: var(--accent);">
                                <span class="material-symbols-rounded"
                                    style="font-size:16px; margin-right:4px;">download</span>
                                전체 저장
                            </button>
                        </div>
                    </div>

                    <div class="prompt-box">
                        <textarea id="promptInput" placeholder="무엇을 그리고 싶으신가요? (예: 사이버펑크 도시 ratio=16:9)"></textarea>
                        <button id="generateBtn" class="generate-btn">
                            <span class="material-symbols-rounded">auto_awesome</span>
                            생성
                        </button>

                        <!-- Smart Actions (Cell Division UI) -->
                        <div class="smart-actions-wrapper">
                            <!-- Main Trigger (Wand) -->
                            <button class="smart-trigger-btn">
                                <span class="material-symbols-rounded">auto_fix_high</span>
                            </button>

                            <!-- Spawning Buttons -->
                            <div class="smart-actions-menu">
                                <!-- 1. Optimization (Magic) -->
                                <button id="btn-optimize" class="cell-btn optimize-btn" title="프롬프트 매직 최적화">
                                    <span class="material-symbols-rounded">auto_fix_high</span>
                                </button>
                                <!-- 2. Analysis (Tags) -->
                                <button id="btn-analyze" class="cell-btn analyze-btn" title="키워드 분석">
                                    <span class="material-symbols-rounded">manage_search</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Smart Tag Container -->
                    <div id="smartTagContainer" class="smart-tag-container" style="display:none;">
                        <!-- Tags will be injected here -->
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal-overlay" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h3>Settings</h3>
                <button id="closeSettingsBtn" class="icon-btn"><span
                        class="material-symbols-rounded">close</span></button>
            </div>
            <div class="modal-content">
                <!-- Account Section -->
                <div class="setting-group" id="accountSection">
                    <label>Account</label>
                    <div id="accountLoggedOut" style="display:flex; align-items:center; gap:12px;">
                        <p class="info-text" style="flex:1; margin:0;">Google 계정으로 로그인하여 데이터를 동기화하세요.</p>
                        <button id="settingsLoginBtn" class="secondary-btn"
                            style="display:flex; align-items:center; gap:6px;">
                            <span class="material-symbols-rounded" style="font-size:16px;">login</span> 로그인
                        </button>
                    </div>
                    <div id="accountLoggedIn" style="display:none; align-items:center; gap:12px;">
                        <img id="settingsUserAvatar" src="assets/default_avatar.png" alt="User"
                            style="width:36px; height:36px; border-radius:50%;">
                        <div style="flex:1;">
                            <div id="settingsUserName" style="font-weight:600;"></div>
                            <div id="settingsUserEmail" style="font-size:0.75rem; color:var(--text-secondary);"></div>
                        </div>
                        <button id="settingsLogoutBtn" class="secondary-btn"
                            style="display:flex; align-items:center; gap:6px;">
                            <span class="material-symbols-rounded" style="font-size:16px;">logout</span> 로그아웃
                        </button>
                    </div>
                </div>

                <div class="setting-group">
                    <label>UI Version</label>
                    <div class="count-selector" style="width: 100%; display: flex; gap: 8px;">
                        <button class="count-btn active" id="uiModeStandard" style="flex: 1;">Standard</button>
                        <button class="count-btn" id="uiModeStudio" style="flex: 1;">Studio (Beta)</button>
                    </div>
                </div>

                <div class="setting-group">
                    <label>API Key Management</label>
                    <div class="api-key-input-group">
                        <input type="text" id="newApiKeyAlias" placeholder="Alias (Optional)"
                            style="flex: 1; min-width: 100px;">
                        <input type="text" id="newApiKeyInput" placeholder="Gemini API Key (starts with AIza...)"
                            autocomplete="off" style="flex: 2;">
                        <button id="addApiKeyBtn" class="secondary-btn">Add</button>
                    </div>
                    <div id="apiKeyList" class="api-key-list">
                        <!-- Items injected by JS -->
                    </div>

                    <!-- Usage Stats Section (PT Based) -->
                    <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border-color);">
                        <label style="margin-bottom:12px;">Estimated Usage (Pacific Time)</label>
                        <div
                            style="display: flex; gap: 12px; background: var(--bg-secondary); padding: 12px; border-radius: 8px;">
                            <div style="flex: 1; text-align: center;">
                                <div style="font-size: 0.75rem; color: var(--text-secondary);">Current RPM</div>
                                <div id="rpmDisplay"
                                    style="font-size: 1.1rem; font-weight: 600; color: var(--text-primary);">0</div>
                            </div>
                            <div style="width: 1px; background: var(--border-color);"></div>
                            <div style="flex: 1; text-align: center;">
                                <div style="font-size: 0.75rem; color: var(--text-secondary);">Daily (PT)</div>
                                <div id="dailyCountDisplay"
                                    style="font-size: 1.1rem; font-weight: 600; color: var(--text-primary);">0</div>
                            </div>
                        </div>
                        <p class="info-text" style="text-align: left; margin-top: 8px; font-size: 0.75rem;">
                            * Resets at Midnight Pacific Time. Estimates based on local browser requests.
                        </p>
                    </div>


                </div>


            </div>

            <!-- Data Management Section -->
            <div class="setting-group" style="padding-top: 20px; border-top: 1px solid var(--border-color);">
                <label>Data Management</label>
                <p class="info-text" style="margin-bottom: 12px;">Backup your history and images to a file.</p>
                <div style="display: flex; gap: 10px; margin-bottom:10px;">
                    <button id="forceSyncBtn" class="primary-btn"
                        style="width:100%; display:flex; align-items:center; justify-content:center; gap:6px;">
                        <span class="material-symbols-rounded">sync</span> Sync to Cloud Now
                    </button>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button id="exportDataBtn" class="secondary-btn"
                        style="flex: 1; display:flex; align-items:center; justify-content:center; gap:6px;">
                        <span class="material-symbols-rounded" style="font-size:16px;">download</span> Export
                    </button>
                    <button id="importDataBtn" class="secondary-btn"
                        style="flex: 1; display:flex; align-items:center; justify-content:center; gap:6px;">
                        <span class="material-symbols-rounded" style="font-size:16px;">upload</span> Import
                    </button>
                    <input type="file" id="importFileInput" accept=".json" style="display: none;">
                </div>
            </div>

            <div class="setting-actions">
                <p class="info-text">Keys are stored locally in your browser. <a
                        href="https://aistudio.google.com/app/apikey" target="_blank" style="color:var(--accent);">Get
                        Key</a></p>
            </div>
        </div>
    </div>
    </div>

    <!-- SVG Filter for Liquid Gooey Effect -->
    <svg xmlns="http://www.w3.org/2000/svg" version="1.1" style="position: absolute; width: 0; height: 0;">
        <defs>
            <filter id="goo">
                <feGaussianBlur in="SourceGraphic" stdDeviation="10" result="blur" />
                <feColorMatrix in="blur" mode="matrix" values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 18 -7"
                    result="goo" />
                <feComposite in="SourceGraphic" in2="goo" operator="atop" />
            </filter>
        </defs>
    </svg>

    <!-- Firebase SDKs (Compat) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>

    <!-- App Scripts -->
    <script src="js/firebase-config.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/db.js"></script>
    <script src="js/app.js"></script>
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(registration => console.log('SW registered: ', registration.scope))
                    .catch(err => console.log('SW registration failed: ', err));
            });
        }
    </script>
</body>

</html>